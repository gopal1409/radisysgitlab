stages:
    - test
    - smoke-test
    - build-docker
variables:
    IMAGE_TAG: $CI_REGISTRY_IMAGE/employee-image:$CI_COMMIT_REF_SLUG
lint_test:
    image: python:3.8.0-slim
    stage: test
    before_script:
        - pip install flake8-html
    script:
        - flake8 --format=html --htmldir=flake_reports/
    artifacts:
        when: always
        paths: 
            - flake_reports/
smoke_test:
    image: python:3.8.0-slim
    stage: test
    before_script:
        - pip install pytest-html 
        - pip3 install SQLAlchemy Flask-SQLAlchemy
    script:
        - pytest --html=pytest_reports/pytest-reports.html --self-contained-html 
    artifacts:
        when: always
        paths: 
            - pytest_reports/
build_docker:
    stage: build-docker
    script:
        - docker build -t $IMAGE_TAG .
        - docker images
